<!-- ======================================================= -->
<!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸç‰ˆåŠŸèƒ½åŒº (ä¿ç•™æ‰€æœ‰æŒ‰é’®ï¼šå›åˆ°é¡¶éƒ¨ã€æœç´¢ã€å¤œé—´æ¨¡å¼) -->
<!-- ======================================================= -->
<footer class="main-footer footer-type-1 text-xs">
    <div id="footer-tools" class="d-flex flex-column">
        <!-- 1. å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
        <a href="javascript:" id="go-to-up" class="btn rounded-circle go-up m-1" rel="go-top">
            <i class="iconfont icon-to-up"></i>
        </a>
        
        <!-- 2. æœç´¢æŒ‰é’® -->
        <a href="javascript:" data-toggle="modal" data-target="#search-modal" class="btn rounded-circle m-1" rel="search" one-link-mark="yes">
            <i class="iconfont icon-search"></i>
        </a>
        
        <!-- 3. è”ç³»/å®¢æœæŒ‰é’® -->
        <a href="https://github.com/shenweiyan/WebStack-Hugo" class="btn rounded-circle kefu m-1" target="_blank" data-toggle="tooltip" data-placement="left" title="è”ç³»æˆ‘ä»¬">
            <i class="mode-ico iconfont icon-qq"></i>
        </a>
        
        <!-- 4. å¤œé—´æ¨¡å¼åˆ‡æ¢æŒ‰é’® (åœ¨éƒ¨ç½²åæ‰ä¼šæ˜¾ç¤º) -->
        <!-- æ³¨æ„ï¼šè¿™æ®µ {{ }} ä»£ç åœ¨æœ¬åœ°é¢„è§ˆå¯èƒ½ä¼šè¢«éšè—ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼Œéƒ¨ç½²åä¼šè‡ªåŠ¨å‡ºç° -->
        {{ if $.Site.Params.nightMode }}
        <a href="javascript:" onclick="window.location.href='javascript:switchNightMode()'" class="btn rounded-circle switch-dark-mode m-1" id="yejian"
            data-toggle="tooltip" data-placement="left" title="å¤œé—´æ¨¡å¼">
            <i class="mode-ico iconfont icon-light"></i>
        </a>
        {{ else }}
        <a href="javascript:" onclick="window.location.href='javascript:switchNightMode()'" class="btn rounded-circle switch-dark-mode m-1" id="yejian"
            data-toggle="tooltip" data-placement="left" title="æ—¥é—´æ¨¡å¼">
            <i class="mode-ico iconfont icon-night"></i>
        </a>
        {{ end }}
    </div>

    <!-- 5. ç‰ˆæƒä¿¡æ¯ -->
    <div class="footer-inner">
        <div class="footer-text">
            &copy; 2025 <strong>æˆ‘çš„ä¸“å±å¯¼èˆªç«™</strong> | 
            <a href="https://github.com/WebStackPage/WebStack-Hugo" target="_blank">WebStack-Hugo</a>
        </div>
    </div>
</footer>

<!-- ======================================================= -->
<!-- ç¬¬äºŒéƒ¨åˆ†ï¼šæ——èˆ°ç‰ˆå¤©æ°”èƒ¶å›Š (é¡¶éƒ¨æ‚¬æµ®) -->
<!-- ======================================================= -->
<div id="info-capsule-container" style="
    position: fixed; 
    top: 20px; 
    left: 0; 
    width: 100%; 
    height: 0; 
    display: flex; 
    justify-content: center; 
    z-index: 9990; 
    pointer-events: none; /* å…³é”®ï¼šè®©é¼ æ ‡ç©¿é€ï¼Œä¸æŒ¡ä¸‹é¢æŒ‰é’® */
">
    
    <!-- èƒ¶å›Šæœ¬ä½“ (å¼€å¯ç‚¹å‡») -->
    <div id="info-capsule-body" style="
        pointer-events: auto;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        border-radius: 24px;
        padding: 6px 20px;
        display: flex;
        align-items: center; 
        justify-content: center;
        gap: 15px;
        font-family: -apple-system, 'PingFang SC', 'Microsoft YaHei', sans-serif;
        color: #333;
        white-space: nowrap;
        transition: all 0.3s ease;
    "
    onmouseover="this.style.background='rgba(255, 255, 255, 0.95)'; this.style.transform='scale(1.02)';"
    onmouseout="this.style.background='rgba(255, 255, 255, 0.85)'; this.style.transform='scale(1)';"
    >

       <!-- å·¦ä¾§ï¼šæ—¶é—´ä¸æ—¥æœŸ -->
       <div class="time-group" style="display: flex; flex-direction: column; align-items: center; text-align: center; min-width: 80px;">
           <div id="time-text" style="font-size: 24px; font-weight: 600; line-height: 1; color: #1d1d1f; letter-spacing: 0.5px; font-variant-numeric: tabular-nums;">
               00:00
           </div>
           <div style="font-size: 10px; color: #666; margin-top: 4px; font-weight: 500;">
               <span id="date-text">...</span> <span style="opacity: 0.4; margin: 0 2px;">|</span> <span id="lunar-text">...</span>
           </div>
       </div>
       
       <!-- åˆ†éš”çº¿ -->
       <div class="divider" style="width: 1px; height: 30px; background: rgba(0,0,0,0.15);"></div>

       <!-- å³ä¾§ï¼šä¸­å›½å¤©æ°”ç½‘å®˜æ–¹æ’ä»¶ -->
       <div id="weather-box" style="
           display: flex; 
           align-items: center; 
           justify-content: center;
           height: 40px;
           opacity: 1;
       ">
           <iframe scrolling="no" src="https://i.tianqi.com/index.php?c=code&id=10&color=%23333&icon=1&site=12" frameborder="0" width="260" height="25" allowtransparency="true"></iframe>
       </div>

    </div>
</div>

<!-- ======================================================= -->
<!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šGemini AI åŠ©æ‰‹ (å³ä¸‹è§’æ‚¬æµ®) -->
<!-- ======================================================= -->

<!-- 1. æ‚¬æµ®è§¦å‘çƒ -->
<div id="gemini-trigger" onclick="toggleGeminiChat()" style="
    position: fixed; 
    bottom: 90px; /* é¿å¼€åŸæ¥çš„å›åˆ°é¡¶éƒ¨æŒ‰é’® */
    right: 20px; 
    z-index: 9999; 
    width: 48px; 
    height: 48px; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
    border-radius: 50%; 
    box-shadow: 0 4px 15px rgba(118, 75, 162, 0.4); 
    cursor: pointer; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    transition: transform 0.3s ease, box-shadow 0.3s ease;
"
onmouseover="this.style.transform='scale(1.1) rotate(10deg)'; this.style.boxShadow='0 6px 20px rgba(118, 75, 162, 0.6)';"
onmouseout="this.style.transform='scale(1) rotate(0deg)'; this.style.boxShadow='0 4px 15px rgba(118, 75, 162, 0.4)';"
title="AI åŠ©æ‰‹">
    <!-- Sparkle Icon -->
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2L14.4 9.6L22 12L14.4 14.4L12 22L9.6 14.4L2 12L9.6 9.6L12 2Z" fill="white"/>
    </svg>
</div>

<!-- 2. èŠå¤©çª—å£ -->
<div id="gemini-chat-window" style="
    display: none; 
    position: fixed; 
    bottom: 150px; 
    right: 20px; 
    width: 340px; 
    height: 480px; 
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.8);
    border-radius: 18px; 
    box-shadow: 0 10px 40px rgba(0,0,0,0.15); 
    z-index: 9999; 
    flex-direction: column; 
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
">
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <div style="background: rgba(248, 249, 250, 0.8); padding: 15px; border-bottom: 1px solid rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center;">
        <span style="font-weight: 600; color: #333; display: flex; align-items: center; gap: 6px;">
            <span style="color: #764ba2;">âœ¨</span> Gemini AI åŠ©æ‰‹
        </span>
        <span onclick="toggleGeminiChat()" style="cursor: pointer; color: #999; font-size: 20px; line-height: 1;">&times;</span>
    </div>
    
    <!-- æ¶ˆæ¯æ˜¾ç¤ºåŒº -->
    <div id="chat-messages" style="flex: 1; padding: 15px; overflow-y: auto; font-size: 13px; line-height: 1.6; scroll-behavior: smooth;">
        <div style="margin-bottom: 12px; color: #666; background: rgba(0,0,0,0.03); padding: 10px; border-radius: 8px;">
            ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„æ™ºèƒ½åŠ©æ‰‹ã€‚<br>
            æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ<br><br>
            è¯•è¯•é—®æˆ‘ï¼š<br>
            â€¢ "å¦‚ä½•åšç•ªèŒ„ç‚’è›‹ï¼Ÿ"<br>
            â€¢ "æ¨èå‡ ä¸ªé…è‰²ç½‘ç«™"<br>
            â€¢ "å†™ä¸€é¦–å…³äºå¯¼èˆªç«™çš„è¯—"
        </div>
    </div>

    <!-- è¾“å…¥åŒº -->
    <div style="padding: 12px; border-top: 1px solid rgba(0,0,0,0.05); background: rgba(255,255,255,0.5); display: flex; gap: 8px; align-items: center;">
        <input type="text" id="user-input" placeholder="è¾“å…¥é—®é¢˜..." style="flex: 1; padding: 10px 14px; border: 1px solid #ddd; border-radius: 20px; outline: none; font-size: 13px; background: rgba(255,255,255,0.8); transition: all 0.2s;" onfocus="this.style.borderColor='#764ba2'" onblur="this.style.borderColor='#ddd'" onkeypress="handleKeyPress(event)">
        <button onclick="sendMessage()" id="send-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(118, 75, 162, 0.3);">
            <i class="iconfont icon-search" style="font-size: 14px; transform: rotate(90deg) scale(1.2);">â¤</i>
        </button>
    </div>
</div>

<!-- ======================================================= -->
<!-- é€»è¾‘è„šæœ¬ (æ—¶é’Ÿ + AI) -->
<!-- ======================================================= -->
<script>
    (function() {
        // --- 1. æ—¶é’Ÿä¸å†œå†é€»è¾‘ (å¤ç”¨ä¹‹å‰çš„æˆåŠŸä»£ç ) ---
        function startClock() {
            const timeText = document.getElementById('time-text');
            const dateText = document.getElementById('date-text');
            const lunarText = document.getElementById('lunar-text');
            if (!timeText) return; 

            function updateClock() {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                if(timeText) timeText.innerText = `${hours}:${minutes}`;

                const months = now.getMonth() + 1;
                const days = now.getDate();
                const weekArr = ["å‘¨æ—¥", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­"];
                const week = weekArr[now.getDay()];
                if(dateText) dateText.innerText = `${months}æœˆ${days}æ—¥ ${week}`;

                try {
                    const lunarDate = new Intl.DateTimeFormat('zh-CN-u-ca-chinese', { day: 'numeric', month: 'numeric' }).format(now);
                    const cleanLunar = lunarDate.split(' ').pop().replace('æœˆ', '/');
                    if(lunarText) lunarText.innerText = `å†œå†${cleanLunar}`;
                } catch (e) {}
            }
            updateClock();
            setInterval(updateClock, 1000);
        }

        // --- 2. AI åŠ©æ‰‹é€»è¾‘ ---
        // âš ï¸ è¯·åœ¨è¿™é‡Œå¡«å…¥ä½ çš„ API Key âš ï¸
        const GEMINI_API_KEY = 'AIzaSyCJogRHhJ8ib96V01JpZW-upOnhdrv3NAU'; 
        
        window.toggleGeminiChat = function() {
            const chatWindow = document.getElementById('gemini-chat-window');
            const triggerBtn = document.getElementById('gemini-trigger');
            if (chatWindow.style.display === 'none') {
                chatWindow.style.display = 'flex';
                // ç®€å•çš„è¿›å…¥åŠ¨ç”»
                chatWindow.style.opacity = '0';
                chatWindow.style.transform = 'translateY(10px)';
                setTimeout(() => {
                    chatWindow.style.opacity = '1';
                    chatWindow.style.transform = 'translateY(0)';
                }, 10);
                document.getElementById('user-input').focus();
            } else {
                chatWindow.style.display = 'none';
            }
        }

        window.handleKeyPress = function(e) {
            if (e.key === 'Enter') sendMessage();
        }

        window.sendMessage = async function() {
            const inputField = document.getElementById('user-input');
            const messagesDiv = document.getElementById('chat-messages');
            const text = inputField.value.trim();
            if (!text) return;
            
            if (!GEMINI_API_KEY) {
                appendMessage("âš ï¸ è¯·å…ˆåœ¨ä»£ç ä¸­é…ç½® API Key", 'ai');
                return;
            }

            // å‘é€ç”¨æˆ·æ¶ˆæ¯
            inputField.value = '';
            appendMessage(text, 'user');
            
            // æ˜¾ç¤º Loading
            const loadingId = 'loading-' + Date.now();
            const loadingDiv = document.createElement('div');
            loadingDiv.id = loadingId;
            loadingDiv.style.marginBottom = '10px';
            loadingDiv.style.color = '#999';
            loadingDiv.style.fontSize = '12px';
            loadingDiv.innerHTML = 'âœ¨ æ€è€ƒä¸­...';
            messagesDiv.appendChild(loadingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: text }] }] })
                });

                const data = await response.json();
                document.getElementById(loadingId).remove(); // ç§»é™¤ loading

                if (data.error) {
                    appendMessage("Error: " + data.error.message, 'ai');
                } else {
                    const aiResponse = data.candidates[0].content.parts[0].text;
                    appendMessage(aiResponse, 'ai');
                }
            } catch (error) {
                document.getElementById(loadingId).remove();
                appendMessage("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œã€‚", 'ai');
            }
        }

        function appendMessage(text, sender) {
            const messagesDiv = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.style.marginBottom = '12px';
            div.style.padding = '8px 12px';
            div.style.borderRadius = '12px';
            div.style.maxWidth = '85%';
            div.style.lineHeight = '1.5';
            div.style.wordWrap = 'break-word';
            
            if (sender === 'user') {
                div.style.background = '#764ba2'; // ç´«è‰²èƒŒæ™¯
                div.style.color = 'white';
                div.style.marginLeft = 'auto'; // é å³
                div.style.borderBottomRightRadius = '2px';
            } else {
                div.style.background = 'rgba(0,0,0,0.05)'; // æµ…ç°èƒŒæ™¯
                div.style.color = '#333';
                div.style.marginRight = 'auto'; // é å·¦
                div.style.borderBottomLeftRadius = '2px';
            }
            
            div.innerHTML = text.replace(/\n/g, '<br>');
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // å¯åŠ¨æ—¶é’Ÿ
        if (document.readyState === 'loading') {
            window.addEventListener('load', startClock);
        } else {
            startClock();
        }
    })();
</script>
