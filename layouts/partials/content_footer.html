<!-- ======================================================= -->
<!-- 1. åŸç”Ÿé¡µè„šåŒº (è¿™ä¸€éƒ¨åˆ†æ˜¯ä½ ç¡®è®¤å¯ä»¥æ˜¾ç¤ºçš„) -->
<!-- ======================================================= -->
<footer class="main-footer footer-type-1 text-xs">
    <div id="footer-tools" class="d-flex flex-column">
        <a href="javascript:" id="go-to-up" class="btn rounded-circle go-up m-1" rel="go-top"><i class="iconfont icon-to-up"></i></a>
        <a href="javascript:" data-toggle="modal" data-target="#search-modal" class="btn rounded-circle m-1" rel="search"><i class="iconfont icon-search"></i></a>
        <a href="https://github.com/shenweiyan/WebStack-Hugo" class="btn rounded-circle kefu m-1" target="_blank"><i class="mode-ico iconfont icon-qq"></i></a>
        {{ if $.Site.Params.nightMode }}
        <a href="javascript:" onclick="window.location.href='javascript:switchNightMode()'" class="btn rounded-circle switch-dark-mode m-1" id="yejian" title="å¤œé—´æ¨¡å¼"><i class="mode-ico iconfont icon-light"></i></a>
        {{ else }}
        <a href="javascript:" onclick="window.location.href='javascript:switchNightMode()'" class="btn rounded-circle switch-dark-mode m-1" id="yejian" title="æ—¥é—´æ¨¡å¼"><i class="mode-ico iconfont icon-night"></i></a>
        {{ end }}
    </div>
    <div class="footer-inner">
        <div class="footer-text">&copy; 2025 <strong>æˆ‘çš„ä¸“å±å¯¼èˆªç«™</strong></div>
    </div>
</footer>

<!-- ======================================================= -->
<!-- 2. æ‚¬æµ®ç»„ä»¶åŒº (ç›´æ¥å†™æ­»åœ¨HTMLé‡Œï¼Œä¿è¯åŠ è½½) -->
<!-- ======================================================= -->
<div id="custom-floating-layer" style="display:none;"> <!-- æš‚æ—¶éšè—ï¼Œç­‰è„šæœ¬æ¬è¿ -->
    
    <!-- A. é¡¶éƒ¨å¤©æ°”èƒ¶å›Š -->
    <div id="my-weather-capsule" style="
        position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 2147483647;
        background: rgba(255, 255, 255, 0.9); border: 1px solid #e0e0e0;
        box-shadow: 0 8px 30px rgba(0,0,0,0.12); border-radius: 50px;
        padding: 5px 20px; display: flex; align-items: center; gap: 15px;
        pointer-events: auto; white-space: nowrap; color: #333; font-family: sans-serif;
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    ">
        <!-- æ—¶é—´éƒ¨åˆ† -->
        <div style="text-align: center; line-height: 1.1; min-width: 60px;">
            <div id="my-clock-time" style="font-size: 22px; font-weight: 700; color: #333;">00:00</div>
            <div id="my-clock-date" style="font-size: 10px; color: #666;">Loading...</div>
        </div>
        <!-- åˆ†å‰²çº¿ -->
        <div style="width: 1px; height: 30px; background: #ddd;"></div>
        <!-- å¤©æ°”æ’ä»¶ (ä¸­å›½å¤©æ°”ç½‘) -->
        <div style="display: flex; align-items: center;">
            <iframe scrolling="no" src="https://i.tianqi.com/index.php?c=code&id=10&color=%23333&icon=1&site=12" frameborder="0" width="220" height="25" allowtransparency="true"></iframe>
        </div>
    </div>

    <!-- B. å³ä¸‹è§’ AI æ‚¬æµ®çƒ -->
    <div id="my-ai-trigger" onclick="toggleMyAI()" style="
        position: fixed; bottom: 100px; right: 20px; z-index: 2147483647;
        width: 50px; height: 50px; background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 50%; box-shadow: 0 4px 15px rgba(118, 75, 162, 0.5);
        cursor: pointer; display: flex; align-items: center; justify-content: center;
        color: white; font-size: 24px; transition: transform 0.2s;
    ">
        âœ¨
    </div>

    <!-- C. AI èŠå¤©çª—å£ -->
    <div id="my-ai-window" style="
        display: none; position: fixed; bottom: 160px; right: 20px; 
        width: 320px; height: 450px; background: rgba(255, 255, 255, 0.95);
        border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        z-index: 2147483647; flex-direction: column; border: 1px solid #eee;
        backdrop-filter: blur(20px); font-family: sans-serif;
    ">
        <!-- æ ‡é¢˜æ  -->
        <div style="padding: 15px; border-bottom: 1px solid #eee; display:flex; justify-content:space-between; align-items:center; background:rgba(240,240,240,0.5);">
            <strong style="color:#333;">Gemini åŠ©æ‰‹</strong>
            <span onclick="toggleMyAI()" style="cursor:pointer; font-size:24px; line-height:1; color:#999;">&times;</span>
        </div>
        <!-- æ¶ˆæ¯åŒº -->
        <div id="my-ai-messages" style="flex:1; padding:15px; overflow-y:auto; font-size:14px;">
            <div style="background:#f0f0f0; padding:10px; border-radius:10px; display:inline-block; color:#666;">
                ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯ AI åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„ï¼Ÿ
            </div>
        </div>
        <!-- è¾“å…¥åŒº -->
        <div style="padding:10px; border-top:1px solid #eee; display:flex; gap:8px;">
            <input id="my-ai-input" type="text" placeholder="è¾“å…¥é—®é¢˜..." style="flex:1; padding:10px; border:1px solid #ddd; border-radius:20px; outline:none;" onkeypress="if(event.key==='Enter') sendMyMessage()">
            <button onclick="sendMyMessage()" style="background:#764ba2; color:white; border:none; width:40px; height:40px; border-radius:50%; cursor:pointer;">â¤</button>
        </div>
    </div>

</div>

<!-- ======================================================= -->
<!-- 3. æ¿€æ´»è„šæœ¬ -->
<!-- ======================================================= -->
<script>
    (function() {
        // âš ï¸ API Key å¡«è¿™é‡Œ âš ï¸
        const API_KEY = 'AIzaSyCJogRHhJ8ib96V01JpZW-upOnhdrv3NAU'; 

        // æ¬è¿å‡½æ•°ï¼šæŠŠç»„ä»¶ä»é¡µè„šæ¬åˆ° body æœ€å¤–å±‚
        function moveComponentsToBody() {
            var layer = document.getElementById('custom-floating-layer');
            if (layer && document.body) {
                document.body.appendChild(layer); // ç§»åŠ¨å…ƒç´ 
                layer.style.display = 'block';    // æ˜¾ç¤ºå…ƒç´ 
            }
        }

        // æ—¶é’Ÿé€»è¾‘
        function startMyClock() {
            var timeEl = document.getElementById('my-clock-time');
            var dateEl = document.getElementById('my-clock-date');
            if(!timeEl) return;

            setInterval(function() {
                var now = new Date();
                var h = now.getHours().toString().padStart(2,'0');
                var m = now.getMinutes().toString().padStart(2,'0');
                timeEl.innerText = h + ':' + m;
                dateEl.innerText = (now.getMonth()+1) + 'æœˆ' + now.getDate() + 'æ—¥';
            }, 1000);
        }

        // AI å¼€å…³é€»è¾‘ (æŒ‚è½½åˆ°windowä»¥ä¾›HTMLè°ƒç”¨)
        window.toggleMyAI = function() {
            var win = document.getElementById('my-ai-window');
            if(win.style.display === 'none') {
                win.style.display = 'flex';
                document.getElementById('my-ai-input').focus();
            } else {
                win.style.display = 'none';
            }
        };

        // AI å‘é€é€»è¾‘
        window.sendMyMessage = async function() {
            var input = document.getElementById('my-ai-input');
            var box = document.getElementById('my-ai-messages');
            var text = input.value.trim();
            if(!text) return;

            if(!API_KEY) {
                box.innerHTML += '<div style="color:red; margin:10px 0;">è¯·åœ¨ä»£ç ä¸­é…ç½® API Key</div>';
                return;
            }

            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            input.value = '';
            box.innerHTML += '<div style="text-align:right; margin:10px 0;"><span style="background:#764ba2; color:white; padding:8px 12px; border-radius:12px; display:inline-block;">' + text + '</span></div>';
            box.scrollTop = box.scrollHeight;

            // æ˜¾ç¤ºLoading
            var loadingId = 'load-' + Date.now();
            box.innerHTML += '<div id="' + loadingId + '" style="color:#999; font-size:12px; margin:5px;">âœ¨ æ€è€ƒä¸­...</div>';
            box.scrollTop = box.scrollHeight;

            try {
                var res = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=' + API_KEY, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: text }] }] })
                });
                var data = await res.json();
                var loader = document.getElementById(loadingId);
                if(loader) loader.remove();

                if(data.error) {
                    box.innerHTML += '<div style="color:red; margin:10px 0;">Error: ' + data.error.message + '</div>';
                } else {
                    var reply = data.candidates[0].content.parts[0].text;
                    // ç®€å•è½¬ä¹‰æ¢è¡Œ
                    reply = reply.replace(/\n/g, '<br>');
                    box.innerHTML += '<div style="text-align:left; margin:10px 0;"><span style="background:#f1f1f1; color:#333; padding:8px 12px; border-radius:12px; display:inline-block;">' + reply + '</span></div>';
                }
            } catch(e) {
                var loader = document.getElementById(loadingId);
                if(loader) loader.remove();
                box.innerHTML += '<div style="color:red; margin:10px 0;">ç½‘ç»œè¿æ¥å¤±è´¥</div>';
            }
            box.scrollTop = box.scrollHeight;
        };

        // å¯åŠ¨æµç¨‹
        // 1. ç«‹å³å°è¯•æ¬è¿
        moveComponentsToBody();
        startMyClock();

        // 2. é¡µé¢åŠ è½½å®Œåå†æ¬è¿ä¸€æ¬¡ (åŒä¿é™©)
        window.addEventListener('load', function() {
            moveComponentsToBody();
        });

    })();
</script>
