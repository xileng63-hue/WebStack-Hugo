<!-- ======================================================= -->
<!-- 1. åŸç”Ÿé¡µè„šåŒº (ä¿ç•™æŒ‰é’®) -->
<!-- ======================================================= -->
<footer class="main-footer footer-type-1 text-xs">
    <div id="footer-tools" class="d-flex flex-column">
        <a href="javascript:" id="go-to-up" class="btn rounded-circle go-up m-1" rel="go-top"><i class="iconfont icon-to-up"></i></a>
        <a href="javascript:" data-toggle="modal" data-target="#search-modal" class="btn rounded-circle m-1" rel="search"><i class="iconfont icon-search"></i></a>
        <a href="https://github.com/shenweiyan/WebStack-Hugo" class="btn rounded-circle kefu m-1" target="_blank"><i class="mode-ico iconfont icon-qq"></i></a>
        {{ if $.Site.Params.nightMode }}
        <a href="javascript:" onclick="window.location.href='javascript:switchNightMode()'" class="btn rounded-circle switch-dark-mode m-1" id="yejian" title="å¤œé—´æ¨¡å¼"><i class="mode-ico iconfont icon-light"></i></a>
        {{ else }}
        <a href="javascript:" onclick="window.location.href='javascript:switchNightMode()'" class="btn rounded-circle switch-dark-mode m-1" id="yejian" title="æ—¥é—´æ¨¡å¼"><i class="mode-ico iconfont icon-night"></i></a>
        {{ end }}
    </div>
    <div class="footer-inner">
        <div class="footer-text">&copy; 2025 <strong>æˆ‘çš„ä¸“å±å¯¼èˆªç«™</strong></div>
    </div>
</footer>

<!-- ======================================================= -->
<!-- 2. æš´åŠ›æ³¨å…¥è„šæœ¬ (ç›´æ¥æŠŠç»„ä»¶å†™è¿› Body) -->
<!-- ======================================================= -->
<script>
    (function() {
        // âš ï¸ API Key å¡«è¿™é‡Œ
        const GEMINI_API_KEY = 'AIzaSyCJogRHhJ8ib96V01JpZW-upOnhdrv3NAU'; 

        // æ ¸å¿ƒï¼šHTML å­—ç¬¦ä¸² (å¤©æ°” + AI)
        const FLOAT_HTML = `
            <!-- A. å¤©æ°”èƒ¶å›Š -->
            <div id="info-capsule-body" style="
                position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 2147483647;
                background: rgba(255, 255, 255, 0.9); border: 1px solid #ddd;
                box-shadow: 0 5px 20px rgba(0,0,0,0.2); border-radius: 50px;
                padding: 5px 20px; display: flex; align-items: center; gap: 15px;
                pointer-events: auto; white-space: nowrap; font-family: sans-serif; color: #333;
            ">
                <div style="text-align: center; line-height: 1.1;">
                    <div id="time-text" style="font-size: 20px; font-weight: bold;">00:00</div>
                    <div style="font-size: 10px; color: #666;"><span id="date-text">...</span></div>
                </div>
                <div style="width: 1px; height: 30px; background: #ddd;"></div>
                <iframe scrolling="no" src="https://i.tianqi.com/index.php?c=code&id=10&color=%23333&icon=1&site=12" frameborder="0" width="260" height="25" allowtransparency="true"></iframe>
            </div>

            <!-- B. AI æŒ‰é’® -->
            <div id="gemini-trigger" onclick="window.toggleGeminiChat()" style="
                position: fixed; bottom: 100px; right: 20px; z-index: 2147483647;
                width: 50px; height: 50px; background: #764ba2; border-radius: 50%;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer;
                display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 24px;
            ">âœ¨</div>

            <!-- C. AI çª—å£ -->
            <div id="gemini-chat-window" style="
                display: none; position: fixed; bottom: 160px; right: 20px; width: 320px; height: 450px;
                background: white; border-radius: 12px; box-shadow: 0 10px 50px rgba(0,0,0,0.3);
                z-index: 2147483647; flex-direction: column; border: 1px solid #eee; font-family: sans-serif;
            ">
                <div style="padding: 15px; border-bottom: 1px solid #eee; display:flex; justify-content:space-between; background:#f9f9f9;">
                    <b>Gemini AI</b> <span onclick="window.toggleGeminiChat()" style="cursor:pointer; font-size:20px;">&times;</span>
                </div>
                <div id="chat-messages" style="flex:1; padding:15px; overflow-y:auto; background:#fff;">
                    <div style="color:#888; font-size:13px;">ğŸ‘‹ æˆ‘æ˜¯ AI åŠ©æ‰‹ï¼Œé—®æˆ‘ç‚¹ä»€ä¹ˆå§ï¼</div>
                </div>
                <div style="padding:10px; border-top:1px solid #eee; display:flex;">
                    <input id="user-input" type="text" placeholder="è¾“å…¥é—®é¢˜..." style="flex:1; padding:8px; border:1px solid #ddd; border-radius:4px;" onkeypress="if(event.key==='Enter') window.sendMessage()">
                    <button onclick="window.sendMessage()" style="margin-left:5px; padding:0 15px; background:#764ba2; color:white; border:none; border-radius:4px; cursor:pointer;">å‘é€</button>
                </div>
            </div>
        `;

        function injectComponents() {
            // 1. æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ (é˜²æ­¢ PJAX é‡å¤)
            if (document.getElementById('injected-layer')) return;

            // 2. åˆ›å»ºå®¹å™¨
            const div = document.createElement('div');
            div.id = 'injected-layer';
            div.innerHTML = FLOAT_HTML;
            
            // 3. æš´åŠ›æŒ‚è½½åˆ° Body (ç¡®ä¿ä¸€å®šæ˜¯ Body çš„ç›´æ¥å­å…ƒç´ )
            document.body.appendChild(div);

            // 4. å¯åŠ¨é€»è¾‘
            startLogic();
        }

        function startLogic() {
            // æ—¶é’Ÿ
            const timeText = document.getElementById('time-text');
            const dateText = document.getElementById('date-text');
            
            setInterval(() => {
                const now = new Date();
                if(timeText) timeText.innerText = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
                if(dateText) dateText.innerText = (now.getMonth()+1) + 'æœˆ' + now.getDate() + 'æ—¥';
            }, 1000);

            // AI å¼€å…³
            window.toggleGeminiChat = function() {
                const win = document.getElementById('gemini-chat-window');
                win.style.display = (win.style.display === 'none') ? 'flex' : 'none';
            };

            // AI å‘é€
            window.sendMessage = async function() {
                const input = document.getElementById('user-input');
                const box = document.getElementById('chat-messages');
                const txt = input.value.trim();
                if(!txt) return;

                if (!GEMINI_API_KEY) {
                    box.innerHTML += `<div style="color:red; margin:5px 0;">è¯·é…ç½® API Key</div>`; 
                    return;
                }

                input.value = '';
                box.innerHTML += `<div style="text-align:right; margin:5px 0;"><span style="background:#764ba2; color:white; padding:5px 10px; border-radius:10px;">${txt}</span></div>`;
                box.innerHTML += `<div style="color:#aaa; font-size:12px;">æ€è€ƒä¸­...</div>`;
                box.scrollTop = box.scrollHeight;

                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_API_KEY}`, {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ contents: [{ parts: [{ text: txt }] }] })
                    });
                    const data = await res.json();
                    box.lastElementChild.remove(); // ç§»é™¤æ€è€ƒä¸­
                    
                    if(data.error) {
                        box.innerHTML += `<div style="color:red;">Error: ${data.error.message}</div>`;
                    } else {
                        const reply = data.candidates[0].content.parts[0].text;
                        box.innerHTML += `<div style="margin:5px 0; background:#f1f1f1; padding:5px 10px; border-radius:10px; display:inline-block;">${reply}</div>`;
                    }
                } catch(e) {
                    box.lastElementChild.remove();
                    box.innerHTML += `<div style="color:red;">ç½‘ç»œé”™è¯¯</div>`;
                }
                box.scrollTop = box.scrollHeight;
            };
        }

        // åŒé‡ä¿é™©å¯åŠ¨ (ç«‹å³è¿è¡Œ + Load åå†è¿è¡Œä¸€æ¬¡)
        injectComponents();
        window.addEventListener('load', injectComponents);
        setTimeout(injectComponents, 1000); // 1ç§’åå†è¯•ä¸€æ¬¡ï¼Œé˜²æ­¢è¢«è¦†ç›–

    })();
</script>
