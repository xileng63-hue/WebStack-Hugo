<div class="main-content flex-fill grid-bg">
    <div class="big-header-banner">
        <div id="header" class="page-header sticky">
            <div class="navbar navbar-expand-md">
                <div class="container-fluid p-0">

                    <a href="" class="navbar-brand d-md-none" title="{{ .Site.Title }}">
                        <img src="{{ absURL $.Site.Params.images.logoCollapseLight }}" class="logo-light"
                            alt="{{ .Site.Title }}">
                        <img src="{{ absURL $.Site.Params.images.logoCollapseDark }}" class="logo-dark d-none"
                            alt="{{ .Site.Title }}">
                    </a>

                    <div class="collapse navbar-collapse order-2 order-md-1">
                        <div class="header-mini-btn">
                            <label>
                                <input id="mini-button" type="checkbox">
                                <svg viewbox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                    <path class="line--1" d="M0 40h62c18 0 18-20-17 5L31 55"></path>
                                    <path class="line--2" d="M0 50h80"></path>
                                    <path class="line--3" d="M0 60h62c18 0 18 20-17-5L31 45"></path>
                                </svg>
                            </label>

                        </div>

                        <ul class="navbar-nav site-menu" style="margin-right: 16px;">
                        {{ range .Site.Data.headers }}
			<li {{ if .list }}class="menu-item-has-children"{{ end }}>
				<a href="{{ .link }}">
                                    <i class="{{ .icon }} fa-lg mr-2"></i>
                                    <span>{{ .item }}</span>
                                </a>
				<ul class="sub-menu">
				{{ range .list }}
				    <li><a href="{{ .url }}">{{ .name }}</a></li>
				{{ end }}
				</ul>
			    </li>
			{{ end }}
			</ul>

                        {{ if not (eq $.Site.Params.qweather.key "") }}
                        <div class="rounded-circle weather">
                            <div id="he-plugin-simple" style="display: contents;"></div>
                            <script>WIDGET = {
                                    CONFIG: {
                                        "modules": "01234",
                                        "background": 5,
                                        "tmpColor": "E4C600",
                                        "tmpSize": 14,
                                        "cityColor": "E4C600",
                                        "citySize": 14,
                                        "aqiColor": "#E4C600",
                                        "aqiSize": 14,
                                        "weatherIconSize": 24,
                                        "alertIconSize": 18,
                                        "padding": "10px 10px 10px 10px",
                                        "shadow": "1",
                                        "language": "auto",
                                        "borderRadius": 5,
                                        "fixed": "false",
                                        "vertical": "middle",
                                        "horizontal": "left",
                                        "key": "{{ $.Site.Params.qweather.key }}"
                                    }
                                }
                            </script>
                            <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script>
                        </div>
                        {{ end }}
                    </div>

                    <ul class="nav navbar-menu text-xs order-1 order-md-2">
                        <!-- 一言 -->
                        {{ with .Site.Params.yiyan }}
                        <li class="nav-item mr-3 mr-lg-0 d-none d-lg-block">
                            <script>
                                fetch('https://v1.hitokoto.cn')
                                    .then(response => response.json())
                                    .then(data => {
                                    const hitokoto = document.getElementById('hitokoto_text')
                                    hitokoto.href = 'https://hitokoto.cn/?uuid=' + data.uuid
                                    hitokoto.innerText = data.hitokoto
                                    })
                                    .catch(console.error)
                            </script>                           
                            <div id="hitokoto"><a href="#" target="_blank" id="hitokoto_text">疏影横斜水清浅，暗香浮动月黄昏。</a></div>
                        </li>
                        {{ end }}
                        <!-- 一言 end -->
                        <!--li class="nav-search ml-3 ml-md-4">
                            <a href="javascript:" data-toggle="modal" data-target="#search-modal"><i
                                    class="iconfont icon-search icon-2x"></i></a>
                        </li-->
                        <li class="nav-item d-md-none mobile-menu ml-3 ml-md-4">
                            <a href="javascript:" id="sidebar-switch" data-toggle="modal"
                                data-target="#sidebar"><i class="iconfont icon-classification icon-2x"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="placeholder" style="height:74px"></div>
    </div>
	
<!-- ======================================================= -->
<!-- 2. 天气组件 (纯 HTML 结构，不依赖 JS 生成) -->
<!-- ======================================================= -->
<!-- 使用 !important 强制层级和显示 -->
<div id="fixed-weather-capsule" style="
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: fixed !important; 
    top: 15px !important; 
    left: 50% !important; 
    transform: translateX(-50%) !important; 
    z-index: 2147483647 !important; 
    
    background: rgba(255, 255, 255, 0.95); 
    border: 1px solid #ddd;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15); 
    border-radius: 50px;
    padding: 6px 20px; 
    align-items: center; 
    gap: 15px;
    height: 40px;
    
    font-family: sans-serif;
    color: #333;
    pointer-events: auto;
">
    <!-- 左侧：时间 (默认显示 Loading，防止 JS 挂了之后空白) -->
    <div style="text-align: center; line-height: 1.1; min-width: 70px;">
        <div id="inject-time" style="font-size: 20px; font-weight: 700; color: #1d1d1f;">--:--</div>
        <div id="inject-date" style="font-size: 10px; color: #666; margin-top: 2px;">日期加载中</div>
    </div>
    
    <!-- 分隔线 -->
    <div style="width: 1px; height: 25px; background: #ccc;"></div>

    <!-- 右侧：中国天气网 -->
    <div style="display: flex; align-items: center; justify-content: center;">
        <iframe scrolling="no" src="https://i.tianqi.com/index.php?c=code&id=10&color=%23333&icon=1&site=12" frameborder="0" width="240" height="25" allowtransparency="true"></iframe>
    </div>
</div>

<!-- ======================================================= -->
<!-- 3. 简单的时钟脚本 -->
<!-- ======================================================= -->
<script>
    (function() {
        // 为了防止组件被父级容器遮挡，尝试将其移到 body 下
        // 即使这一步失败，上面的 HTML 也会显示，只是位置可能受限
        try {
            var capsule = document.getElementById('fixed-weather-capsule');
            if (capsule && document.body && capsule.parentNode !== document.body) {
                document.body.appendChild(capsule);
            }
        } catch(e) { console.log('搬运失败，保持原位'); }

        // 启动时钟
        var timeEl = document.getElementById('inject-time');
        var dateEl = document.getElementById('inject-date');
        
        function update() {
            var now = new Date();
            var h = now.getHours().toString().padStart(2, '0');
            var m = now.getMinutes().toString().padStart(2, '0');
            if(timeEl) timeEl.innerText = h + ':' + m;
            
            var month = now.getMonth() + 1;
            var day = now.getDate();
            var weeks = ["周日", "周一", "周二", "周三", "周四", "周五", "周六"];
            var w = weeks[now.getDay()];
            if(dateEl) dateEl.innerText = month + '月' + day + '日 ' + w;
        }
        
        setInterval(update, 1000);
        update(); // 立即执行一次
    })();
</script>
