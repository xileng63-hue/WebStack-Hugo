<footer class="main-footer footer-type-1 text-xs">
    <!-- è¿™é‡Œçš„ div åªæ˜¯å ä½ï¼Œå†…å®¹ä¼šè¢«ä¸‹é¢çš„ JS æ¬è¿åˆ° body ä¸Š -->
    <div id="footer-tools" class="d-flex flex-column">
        <div class="footer-text text-center">
            <p style="margin: 0;">&copy; 2025 <strong>æˆ‘çš„ä¸“å±å¯¼èˆªç«™</strong></p>
        </div>
    </div>
</footer>

<!-- ======================================================= -->
<!-- æ——èˆ°ç‰ˆä¿¡æ¯èƒ¶å›Š (å°†é€šè¿‡ JS ç§»åŠ¨åˆ° Body æ ¹èŠ‚ç‚¹) -->
<!-- ======================================================= -->
<div id="info-capsule" style="
    display: none; /* åˆå§‹éšè—ï¼Œé˜²æ­¢é—ªçƒï¼ŒJSæ¬è¿åä¼šæ˜¾ç¤º */
    position: fixed; 
    top: 20px; 
    left: 50%; 
    transform: translateX(-50%); 
    z-index: 2147483647; /* è¿™æ˜¯ä¸€ä¸ªæå¤§çš„å€¼ï¼Œç¡®ä¿åœ¨æ‰€æœ‰å›¾å±‚ä¹‹ä¸Š */
    
    /* --- æ——èˆ°çº§ç£¨ç ‚ç»ç’ƒç‰¹æ•ˆ --- */
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.6);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
    border-radius: 24px;
    
    /* --- å¸ƒå±€è®¾ç½® --- */
    padding: 8px 24px;
    align-items: center; 
    justify-content: center;
    gap: 20px;
    
    /* å­—ä½“è®¾ç½® */
    font-family: -apple-system, 'PingFang SC', 'Microsoft YaHei', sans-serif;
    color: #333;
    white-space: nowrap;
    
    /* ç¡®ä¿ä¸å—çˆ¶çº§æ ·å¼å½±å“çš„é‡ç½®å±æ€§ */
    box-sizing: border-box;
    line-height: normal;
    text-align: left;
    pointer-events: auto;
    
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
">

   <!-- å·¦ä¾§ï¼šæ—¶é—´ä¸æ—¥æœŸ -->
   <div class="time-group" style="display: flex; flex-direction: column; align-items: center; text-align: center; min-width: 90px;">
       <!-- å¤§å·æ—¶é—´ -->
       <div id="time-text" style="font-size: 26px; font-weight: 600; line-height: 1; color: #1d1d1f; letter-spacing: 0.5px; font-variant-numeric: tabular-nums;">
           00:00
       </div>
       <!-- æ—¥æœŸä¸å†œå† -->
       <div style="font-size: 11px; color: #666; margin-top: 5px; font-weight: 500;">
           <span id="date-text">...</span> <span style="opacity: 0.4; margin: 0 3px;">|</span> <span id="lunar-text">...</span>
       </div>
   </div>
   
   <!-- åˆ†éš”çº¿ -->
   <div class="divider" style="width: 1px; height: 32px; background: rgba(0,0,0,0.15);"></div>

   <!-- å³ä¾§ï¼šæ™ºèƒ½å¤©æ°”è½®æ’­ -->
   <div id="weather-box" style="
       display: flex; 
       align-items: center; 
       justify-content: center;
       min-width: 120px;
       height: 46px;
       opacity: 1;
       transition: opacity 0.3s ease;
       text-align: center;
   ">
       <span style="font-size: 12px; color: #888;">æ­£åœ¨å®šä½...</span>
   </div>

</div>

<!-- æ™ºèƒ½è„šæœ¬ -->
<script>
    (function() {
        // --- æ ¸å¿ƒä¿®å¤ï¼šé‡‘è‰è„±å£³æ³• ---
        // å°†ç»„ä»¶ç§»åŠ¨åˆ° body ä¸‹ï¼Œæ‰“ç ´æ‰€æœ‰çˆ¶çº§å®¹å™¨çš„é™åˆ¶ï¼ˆoverflow:hidden, z-index, transform ç­‰ï¼‰
        var capsule = document.getElementById('info-capsule');
        if (capsule && document.body) {
            document.body.appendChild(capsule);
            capsule.style.display = 'flex'; // æ¬è¿åˆ°ä½åï¼Œæ˜¾ç¤ºå‡ºæ¥
        }

        // --- é…ç½® ---
        const CAROUSEL_INTERVAL = 8000; 
        
        // --- çŠ¶æ€å˜é‡ ---
        let weatherData = null;
        let currentSlideIndex = 0; 
        let weatherInterval = null;

        // --- å¤©æ°”ä»£ç è½¬ Emoji ---
        function getWeatherIcon(code) {
            if (code === 0) return 'â˜€ï¸';
            if (code >= 1 && code <= 3) return 'â›…';
            if (code >= 45 && code <= 48) return 'ğŸŒ«ï¸';
            if (code >= 51 && code <= 67) return 'ğŸŒ§ï¸';
            if (code >= 71 && code <= 77) return 'â„ï¸';
            if (code >= 80 && code <= 82) return 'ğŸŒ¦ï¸';
            if (code >= 95 && code <= 99) return 'â›ˆï¸';
            return 'ğŸŒ¡ï¸';
        }

        // --- è·å–ä½ç½®å¹¶åŠ è½½å¤©æ°” ---
        async function initWeather() {
            let latitude = 39.9042; // é»˜è®¤åŒ—äº¬
            let longitude = 116.4074;
            let city = "æœ¬åœ°";

            try {
                // 3ç§’å®šä½è¶…æ—¶æ§åˆ¶
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000);

                const geoRes = await fetch('https://get.geojs.io/v1/ip/geo.json', { signal: controller.signal });
                const geoData = await geoRes.json();
                
                if (geoData.latitude && geoData.longitude) {
                    latitude = geoData.latitude;
                    longitude = geoData.longitude;
                    city = geoData.city || geoData.region || "æœ¬åœ°";
                }
                clearTimeout(timeoutId);
            } catch (e) {
                console.warn("å®šä½è¶…æ—¶ï¼Œä½¿ç”¨é»˜è®¤åæ ‡");
            }

            try {
                const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=3`);
                const wData = await weatherRes.json();

                weatherData = {
                    city: city,
                    current: wData.current_weather,
                    daily: wData.daily
                };

                renderWeather();
                if (weatherInterval) clearInterval(weatherInterval);
                weatherInterval = setInterval(renderWeather, CAROUSEL_INTERVAL);
            } catch (e) {
                console.error("Weather API Error:", e);
                document.getElementById('weather-box').innerHTML = '<span style="font-size:12px;color:#999;">å¤©æ°”æœåŠ¡ç»´æŠ¤ä¸­</span>';
            }
        }

        // --- æ¸²æŸ“å¤©æ°” ---
        function renderWeather() {
            if (!weatherData || !weatherData.daily) return;

            const box = document.getElementById('weather-box');
            box.style.opacity = '0';
            
            setTimeout(() => {
                let htmlContent = '';
                
                if (currentSlideIndex === 0) {
                    // å®æ—¶
                    const temp = Math.round(weatherData.current.temperature);
                    const icon = getWeatherIcon(weatherData.current.weathercode);
                    const displayCity = weatherData.city; 
                    
                    htmlContent = `
                        <div style="display:flex; flex-direction:column; align-items:center;">
                            <div style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 3px;">
                                ${icon} ${temp}Â°C
                            </div>
                            <div style="font-size: 11px; color: #666;">
                                ğŸ“ ${displayCity} Â· å®æ—¶
                            </div>
                        </div>
                    `;
                    currentSlideIndex = 1; 
                } else {
                    // é¢„æŠ¥
                    const dayIndex = currentSlideIndex;
                    if (weatherData.daily.time[dayIndex]) {
                        const max = Math.round(weatherData.daily.temperature_2m_max[dayIndex]);
                        const min = Math.round(weatherData.daily.temperature_2m_min[dayIndex]);
                        const icon = getWeatherIcon(weatherData.daily.weathercode[dayIndex]);
                        const dayName = (dayIndex === 1) ? "æ˜å¤©" : "åå¤©";

                        htmlContent = `
                            <div style="display:flex; flex-direction:column; align-items:center;">
                                <div style="font-size: 15px; font-weight: 600; color: #555; margin-bottom: 3px;">
                                    ${dayName} ${icon}
                                </div>
                                <div style="font-size: 11px; color: #666;">
                                    ${min}Â° ~ ${max}Â°
                                </div>
                            </div>
                        `;
                    }
                    currentSlideIndex++;
                    if (currentSlideIndex > 2) currentSlideIndex = 0; 
                }

                box.innerHTML = htmlContent;
                box.style.opacity = '1'; 
            }, 300);
        }

        // --- æ—¶é’Ÿä¸å†œå† ---
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const timeEl = document.getElementById('time-text');
            if(timeEl) timeEl.innerText = `${hours}:${minutes}`;

            const months = now.getMonth() + 1;
            const days = now.getDate();
            const weekArr = ["å‘¨æ—¥", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­"];
            const week = weekArr[now.getDay()];
            const dateEl = document.getElementById('date-text');
            if(dateEl) dateEl.innerText = `${months}æœˆ${days}æ—¥ ${week}`;

            try {
                const lunarDate = new Intl.DateTimeFormat('zh-CN-u-ca-chinese', {
                    day: 'numeric',
                    month: 'numeric'
                }).format(now);
                const cleanLunar = lunarDate.split(' ').pop().replace('æœˆ', '/');
                const lunarEl = document.getElementById('lunar-text');
                if(lunarEl) lunarEl.innerText = `å†œå†${cleanLunar}`;
            } catch (e) {}
        }
        
        initWeather();
        updateClock();
        setInterval(updateClock, 1000);

        // --- äº¤äº’ç‰¹æ•ˆ ---
        const cap = document.getElementById('info-capsule');
        if(cap) {
            cap.addEventListener('mouseenter', function() {
                this.style.background = 'rgba(255, 255, 255, 0.95)';
                this.style.transform = 'translateX(-50%) scale(1.02)';
            });
            cap.addEventListener('mouseleave', function() {
                this.style.background = 'rgba(255, 255, 255, 0.85)';
                this.style.transform = 'translateX(-50%) scale(1)';
            });
        }
    })();
</script>
