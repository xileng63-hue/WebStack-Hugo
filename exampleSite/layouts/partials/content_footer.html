<footer class="main-footer footer-type-1 text-xs">
    <div id="footer-tools" class="d-flex flex-column">
        
        <!-- ======================================================= -->
        <!-- æ——èˆ°ç‰ˆä¿¡æ¯èƒ¶å›Šï¼šå±…ä¸­å¯¹é½ + ç¨³å¥å®šä½ -->
        <!-- ======================================================= -->
        <div id="info-capsule" style="
            position: fixed; 
            top: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 99999;
            
            /* --- æ——èˆ°çº§ç£¨ç ‚ç»ç’ƒç‰¹æ•ˆ --- */
            background: rgba(255, 255, 255, 0.8); /* ä¸é€æ˜åº¦å¾®è°ƒï¼Œæ›´æ¸…æ™° */
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            border-radius: 24px;
            
            /* --- å¸ƒå±€è®¾ç½® --- */
            padding: 8px 30px; /* å¢åŠ å·¦å³å†…è¾¹è· */
            display: flex; 
            align-items: center; 
            justify-content: center;
            gap: 25px; /* å¢åŠ é—´è·ï¼Œè®©å·¦å³æ›´å¹³è¡¡ */
            
            /* å­—ä½“è®¾ç½® */
            font-family: -apple-system, 'PingFang SC', 'Microsoft YaHei', sans-serif;
            color: #333;
            white-space: nowrap;
            
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        "
        onmouseover="this.style.background='rgba(255, 255, 255, 0.95)'; this.style.transform='translateX(-50%) scale(1.02)';"
        onmouseout="this.style.background='rgba(255, 255, 255, 0.8)'; this.style.transform='translateX(-50%) scale(1)';"
        >

           <!-- å·¦ä¾§ï¼šæ—¶é—´ä¸æ—¥æœŸ (å±…ä¸­å¯¹é½) -->
           <div class="time-group" style="display: flex; flex-direction: column; align-items: center; text-align: center; min-width: 90px;">
               <!-- å¤§å·æ—¶é—´ -->
               <div id="time-text" style="font-size: 26px; font-weight: 600; line-height: 1; color: #1d1d1f; letter-spacing: 0.5px;">
                   00:00
               </div>
               <!-- æ—¥æœŸä¸å†œå† -->
               <div style="font-size: 11px; color: #666; margin-top: 5px; font-weight: 500;">
                   <span id="date-text">...</span> <span style="opacity: 0.4;">|</span> <span id="lunar-text">...</span>
               </div>
           </div>
           
           <!-- åˆ†éš”çº¿ -->
           <div class="divider" style="width: 1px; height: 36px; background: rgba(0,0,0,0.1);"></div>

           <!-- å³ä¾§ï¼šæ™ºèƒ½å¤©æ°”è½®æ’­ (å±…ä¸­å¯¹é½) -->
           <div id="weather-box" style="
               display: flex; 
               align-items: center; 
               justify-content: center; /* æ”¹ä¸ºå±…ä¸­ */
               min-width: 120px;
               height: 46px;
               opacity: 1;
               transition: opacity 0.3s ease;
               text-align: center; /* æ–‡å­—å±…ä¸­ */
           ">
               <span style="font-size: 12px; color: #888;">æ­£åœ¨å®šä½...</span>
           </div>

        </div>

        <!-- 3. æ™ºèƒ½è„šæœ¬ -->
        <script>
            // --- é…ç½® ---
            const CAROUSEL_INTERVAL = 8000; 
            
            // --- çŠ¶æ€å˜é‡ ---
            let weatherData = null;
            let currentSlideIndex = 0; 
            let weatherInterval = null;

            // --- å¤©æ°”ä»£ç è½¬ Emoji ---
            function getWeatherIcon(code) {
                if (code === 0) return 'â˜€ï¸';
                if (code >= 1 && code <= 3) return 'â›…';
                if (code >= 45 && code <= 48) return 'ğŸŒ«ï¸';
                if (code >= 51 && code <= 67) return 'ğŸŒ§ï¸';
                if (code >= 71 && code <= 77) return 'â„ï¸';
                if (code >= 80 && code <= 82) return 'ğŸŒ¦ï¸';
                if (code >= 95 && code <= 99) return 'â›ˆï¸';
                return 'ğŸŒ¡ï¸';
            }

            // --- è·å–ä½ç½®å¹¶åŠ è½½å¤©æ°” (å¸¦å…œåº•é€»è¾‘) ---
            async function initWeather() {
                let latitude = 39.9042; // é»˜è®¤åŒ—äº¬
                let longitude = 116.4074;
                let city = "æœ¬åœ°";

                try {
                    // å°è¯•è·å–ç²¾å‡†å®šä½
                    // ä½¿ç”¨ fetch çš„ signal å¢åŠ è¶…æ—¶æ§åˆ¶ï¼Œé˜²æ­¢ä¸€ç›´å¡åœ¨"æ­£åœ¨å®šä½"
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 3000); // 3ç§’è¶…æ—¶

                    const geoRes = await fetch('https://get.geojs.io/v1/ip/geo.json', { signal: controller.signal });
                    const geoData = await geoRes.json();
                    
                    if (geoData.latitude && geoData.longitude) {
                        latitude = geoData.latitude;
                        longitude = geoData.longitude;
                        city = geoData.city || geoData.region || "æœ¬åœ°";
                    }
                    clearTimeout(timeoutId);

                } catch (e) {
                    console.warn("å®šä½è¶…æ—¶æˆ–å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤åæ ‡:", e);
                    // å¤±è´¥æ—¶ä¸ä¸­æ–­ï¼Œç»§ç»­ç”¨é»˜è®¤åæ ‡è¯·æ±‚å¤©æ°”ï¼Œä¿è¯ç»„ä»¶æœ‰å†…å®¹æ˜¾ç¤º
                }

                try {
                    // è¯·æ±‚å¤©æ°”æ•°æ®
                    const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=3`);
                    const wData = await weatherRes.json();

                    weatherData = {
                        city: city,
                        current: wData.current_weather,
                        daily: wData.daily
                    };

                    // å¯åŠ¨æ¸²æŸ“
                    renderWeather();
                    // æ¸…é™¤æ—§å®šæ—¶å™¨ï¼ˆé˜²æ­¢é‡å¤ï¼‰å¹¶å¯åŠ¨æ–°å®šæ—¶å™¨
                    if (weatherInterval) clearInterval(weatherInterval);
                    weatherInterval = setInterval(renderWeather, CAROUSEL_INTERVAL);

                } catch (e) {
                    console.error("Weather API Error:", e);
                    document.getElementById('weather-box').innerHTML = '<span style="font-size:12px;color:#999;">å¤©æ°”æœåŠ¡ç»´æŠ¤ä¸­</span>';
                }
            }

            // --- æ¸²æŸ“å¤©æ°”é€»è¾‘ ---
            function renderWeather() {
                if (!weatherData || !weatherData.daily) return;

                const box = document.getElementById('weather-box');
                
                // æ·¡å‡º
                box.style.opacity = '0';
                
                setTimeout(() => {
                    let htmlContent = '';
                    
                    // 0:å®æ—¶ -> 1:æ˜å¤© -> 2:åå¤© -> 0
                    if (currentSlideIndex === 0) {
                        // === å®æ—¶å¤©æ°” ===
                        const temp = Math.round(weatherData.current.temperature);
                        const icon = getWeatherIcon(weatherData.current.weathercode);
                        const displayCity = weatherData.city; 
                        
                        htmlContent = `
                            <div style="display:flex; flex-direction:column; align-items:center;">
                                <div style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 3px;">
                                    ${icon} ${temp}Â°C
                                </div>
                                <div style="font-size: 11px; color: #666;">
                                    ğŸ“ ${displayCity} Â· å®æ—¶
                                </div>
                            </div>
                        `;
                        currentSlideIndex = 1; 
                    } else {
                        // === æœªæ¥é¢„æŠ¥ ===
                        const dayIndex = currentSlideIndex;
                        if (weatherData.daily.time[dayIndex]) {
                            const max = Math.round(weatherData.daily.temperature_2m_max[dayIndex]);
                            const min = Math.round(weatherData.daily.temperature_2m_min[dayIndex]);
                            const icon = getWeatherIcon(weatherData.daily.weathercode[dayIndex]);
                            const dayName = (dayIndex === 1) ? "æ˜å¤©" : "åå¤©";

                            htmlContent = `
                                <div style="display:flex; flex-direction:column; align-items:center;">
                                    <div style="font-size: 15px; font-weight: 600; color: #555; margin-bottom: 3px;">
                                        ${dayName} ${icon}
                                    </div>
                                    <div style="font-size: 11px; color: #666;">
                                        ${min}Â° ~ ${max}Â°
                                    </div>
                                </div>
                            `;
                        }
                        currentSlideIndex++;
                        if (currentSlideIndex > 2) currentSlideIndex = 0; 
                    }

                    box.innerHTML = htmlContent;
                    box.style.opacity = '1'; // æ·¡å…¥
                }, 300);
            }

            // --- æ—¶é’Ÿä¸å†œå† ---
            function updateClock() {
                const now = new Date();
                
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                document.getElementById('time-text').innerText = `${hours}:${minutes}`;

                const months = now.getMonth() + 1;
                const days = now.getDate();
                const weekArr = ["å‘¨æ—¥", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­"];
                const week = weekArr[now.getDay()];
                document.getElementById('date-text').innerText = `${months}æœˆ${days}æ—¥ ${week}`;

                try {
                    const lunarDate = new Intl.DateTimeFormat('zh-CN-u-ca-chinese', {
                        day: 'numeric',
                        month: 'numeric'
                    }).format(now);
                    const cleanLunar = lunarDate.split(' ').pop().replace('æœˆ', '/');
                    document.getElementById('lunar-text').innerText = `å†œå†${cleanLunar}`;
                } catch (e) {
                    document.getElementById('lunar-text').innerText = "";
                }
            }
            
            // --- å¯åŠ¨ ---
            initWeather();
            updateClock();
            setInterval(updateClock, 1000);

            // æ‰‹æœºé€‚é…
            if (window.innerWidth < 400) {
                 document.getElementById('info-capsule').style.padding = "6px 16px";
                 document.getElementById('info-capsule').style.gap = "15px";
                 document.getElementById('time-text').style.fontSize = "22px";
            }
        </script>

        <!-- åº•éƒ¨ç‰ˆæƒæ–‡å­— -->
        <div class="footer-text text-center">
            <p style="margin: 0;">&copy; 2025 <strong>æˆ‘çš„ä¸“å±å¯¼èˆªç«™</strong></p>
        </div>
        
    </div>
</footer>
